<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommerse Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="aform" onsubmit="onsubmit1(event)" autocomplete="on">
        <label for="price">Price:</label>
        <input id="price" type ="number" name="nprice">
        <label for="pname">Product Name:</label>
        <input id="pname" name="npname">
        <label for="cat">Category:</label>
        <select id="cat" name="ncat">
            <option value="food">Food Item</option>
            <option value="skincare">Skincare Item</option>
            <option value="elecronics">Electronic Item</option>
        </select>
        <button type="submit">Add Product</button>
    </form>
    <h1>Products:</h1>
    <h3>Food Items:</h3>
    <ul id="foodList"></ul>
    <h3>Skincare Items:</h3>
    <ul id="skincareList"></ul>
    <h3>Electronic Items:</h3>
    <ul id="elecronicsList"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        var uRL = "https://crudcrud.com/api/5b0933d58d52464eb2cd87915107ef37/itemsInfo";
        
        //to display existing items
        window.addEventListener("DOMContentLoaded",async ()=>{
            try{
                let res = await axios.get(uRL);
                //console.log(res.data);
                for(let i=0;i<res.data.length;i++){
                    showOnScreen(res.data[i]);
                }
            }catch(err){
                console.log(err);
            }
        })

        //show Data on screen
        function showOnScreen(obj){
            if(obj.cat=="food"){
                let list = document.getElementById("foodList");
                list.innerHTML= list.innerHTML + 
                    `<li id=${obj._id}> Name: ${obj.pname} ----- Price: ${obj.price} Rs  --- <button onclick="deleteFun('${obj._id}')">Delete</button></li>`;
            }else if(obj.cat=="skincare"){
                let list = document.getElementById("skincareList");
                list.innerHTML= list.innerHTML + 
                    `<li id=${obj._id}> Name: ${obj.pname} ----- Price: ${obj.price} Rs  --- <button onclick="deleteFun('${obj._id}')">Delete</button></li>`;
            }
            else{
                let list = document.getElementById("elecronicsList");
                list.innerHTML= list.innerHTML + 
                    `<li id=${obj._id}> Name: ${obj.pname} ----- Price: ${obj.price} Rs  --- <button onclick="deleteFun('${obj._id}')">Delete</button></li>`;
            }
        }

        //After submit button
        async function onsubmit1(event){
            event.preventDefault();
            try{
                let myobj = {
                    price: event.target.nprice.value,
                    pname: event.target.npname.value,
                    cat: event.target.ncat.value
                }

                let op = await axios.post(uRL,myobj);
                showOnScreen(op.data);

                event.target.nprice.value="";
                event.target.npname.value="";
                event.target.ncat.selectedIndex = 0;
            }catch(err){
                console.log(err);
            }
            
        }

        //Delete funcion
        async function deleteFun(objid){
            try{
                console.log("inside ");
                let del = await axios.delete(`${uRL}/${objid}`);
                todel = document.getElementById(objid);
                todel.remove();
            }catch(err){
                console.log(err);
            }
        }

    </script>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>